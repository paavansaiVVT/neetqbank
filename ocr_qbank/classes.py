from sqlalchemy import create_engine, Column, Integer, String, Text, JSON,BLOB,ARRAY,Float
from pydantic import BaseModel
from sqlalchemy.ext.declarative import declarative_base
from langchain_core.output_parsers import JsonOutputParser
from typing import List, Optional

Base = declarative_base()

class RefineMCQs(BaseModel):
    user_id: int
    uuid: str
    file_path: str
    file_name: str

topic_name_list= ['Dimensional Formula', 'Conversion Of Units For One System To Another', 'Priniciple Of Homoginity', 'Dimensional Analysis', 'Deriving Equations', 'Limitations Of Dimensional Analysis', 'Percentage Error', 'Significant Figures', 'Rounding Of Numbers', 'Distance And Displacement', 'Avg Speed And Avg Velocity', 'Acceleration And Horizontal Motion', 'Motion Under Gravity', 'Graphs', 'Relative Velocity', 'Force', 'Impulse', 'Connected Bodies And Apparent Weight', 'Law Of Conservation Of Linear Momentum', 'Laws Of Friction', 'Friction On Vertical Surface', 'Motion On A Horizontal Rough Surface', 'Motion Of A Body On The Inclined Plane', 'Pulling (Or) Pushing A Body', 'Work Done By Constant Force', 'Work Done By Variable Force', 'Kinetic Energy', 'Potential Energy', 'Spring Energy', 'Law Of Conservation Of Energy', 'Work Energy Theorem By Constant Force', 'Work Energy Theorm For Variable Force', 'Vertical Circular Motion', 'Power', 'Elastic Collisions', 'Inelastic Collision', 'Cofficient Of Restitution', 'Uniform Circular Motion', 'Centre Of Mass', 'Motion Of Centre Of Mass', 'Rotational Variables', 'Rotational Kinematics', 'Rotational Inertia Of Solid Bodies', 'Angular Momentum And Conversation Of Angular Momentum', 'Rotational Dynamics', 'Rolling Motion', "Kepler'S Laws", "Variation Of 'G'", 'Gravitational Field,Gravitational Potential', 'Escape Velocity', 'Orbital Velocity', 'Gravitational Potential Energy', 'Satellites', 'Stress & Strain', 'Youngs Modules', 'Bulk Modules', 'Rigidity Modules', "Poisson'S Ratio", 'Strain Energy', 'Relation Between Y,K And Rigidity Modules', 'Heat,Zerothlaw,Temperature', 'Internal Energy,1St Law Of Thermodynamics', 'Cp And Cv Their Relations', 'Different Thermodynamic Process', 'Cyclic Process,Heat Engine,Refrigerator', 'Joules Law, External Work', 'Pressure And Kinetic Interpretation Of Temperature', 'Various Speeds Of Gas Molecules', 'Specific Heats, Degrees Of Freedom', 'Displacement', 'Velocity-Acceleration', 'Simple Pendulum', 'Oscillations Due To Spring', 'Energy Of A Particle Executing Shm', 'Electric Potential And Potential Energy', 'Electric Potential Due To Dipole', 'Torque Acting On Dipole', 'Relation Between E and V', 'Capacitance', 'Different Types Of Capacitor', 'Parallel Plate Capacitor', 'Capacitors In Series And In Parallel', 'Energy Stored In A Condenser', 'Electric Dipole', 'Electric Current And Drift Velocity', "Ohm'S Law Combination Of Resistors", 'Electric Power And Joules Law', 'Cells And Combination Of Cells', "Kirchhoff'S Law And Wheatstone Bridge", 'Metrebridge', 'Potentiometer', 'Magnetic Moment And Resultant Magnetic Moment', 'Magnetic Field', 'Couple Acting On The Bar Magnet', 'Field Of A Bar Magnet', 'Superposition Of Magnetic Fields', 'Time Period Of A Block Suspended Magnet In A Uniform Magnetic Field', 'Types Of Magnetic Materials', 'Terrestrial Magnetism', "Magnetic Flux & Faraday'S Law & Lenz'S Law", 'Motional Emf', 'Induced Electric Field, Eddy Currents', 'Self Induction And Mutal Induction', "Maxwell'S Equation, Displacement Current", 'Electromagnetic Spectrum', 'Wave Equation', 'Relation Between E And B', 'Momentum And Force', "Huygen'S Principle, Doppler'S Effect", 'Interference (Ydse)', 'Diffraction', 'Polarisation', 'Resolving Power', "Photoelectric Effect (Lenard'S Experiment)", 'Einsteins Photo Electric Equation', 'Photocells', 'De-Broglie Hypothesis', 'Alpha Ray Scattering', "Bohr'S Model Of Atom", 'Atomic Specta', 'X-Rays', 'Instrinsic Semi Conductor And Extrinic Semiconductor', 'Pn Junction Diode, Zenor Diode', 'Transistors', 'Logic Gates', 'Communication Systems', 'Addition,Subtraction And Resolution Of Vectors', 'Scalar Product (Or) Dot Product', 'Vector Product (Or) Cross Product', 'Different Types Of Vectors', 'Resoulution Of Vectors', 'Parallelogram Law Of Vectors', 'Triangle Law,Polygon Law & Lamis Theorem', 'Motion Of A Boat In River', 'Oblique Projectile', 'Horizontal Projectile', "Pressure And Pascal'S Law", 'Variation Of Pressure,Upthrust', 'Equation Of Continuty, Bernoullis Theorem', 'Torrecellis Throrem', 'Poiseuille Equation', 'Dynamic Lift', 'Terminal Velocity', 'Coefficient Of Viscosity & Viscous Force', 'Force Due To Surface Tension', 'Work & Surface Energy', 'Capillarity & Capillary Rise', 'Excess Pressure', 'Calorimetry', 'Measurment Of Temperature', 'Thermal Expansion Of Solids', 'Thermal Expansion Of Liquids', 'Thermal Expansion Of Gases', 'Thermal Conductivity', "Newton'S Law Of Cooling", 'Radiation', 'Calorimetry', 'Progressive Waves', 'Speed Of A Transverse Wave', 'Principle Of Super Position Interference And Stationary Waves On Stretched Strings', 'Velocity Of Sound', 'Organ Pipes', 'Beats', 'Doppler Effect', 'Sonometer', "Coulomb'S Law", 'Electric Field', 'Motion Of A Charged Particle In Uniform Eletric Field', 'Electric Flux And Gauss Law', 'Instantaneous, Peak, Rms and Average Value Of A.C', 'A.C Across R-L, R-C, L-C And L-C-R Circuit', 'Resontant Frequency, L-C Oscillations', 'Choke Coil, Transformer', 'Power', 'Alpha Ray Scattering', "Bohr'S Model Of Atom", 'Atomic Specta', 'X-Rays', 'Laws Of Chemical Combinations', 'Mole Concept', 'Equivalent Weight', 'Concentration Methods', 'Stoichiometric Calculations', 'Emprirical Formula & Molecular Formula', 'Addition,Subtraction And Resolution Of Vectors', 'Scalar Product (Or) Dot Product', 'Vector Product (Or) Cross Product', 'Different Types Of Vectors', 'Resoulution Of Vectors', 'Parallelogram Law Of Vectors', 'Triangle Law,Polygon Law & Lamis Theorem', 'Motion Of A Boat In River', 'Oblique Projectile', 'Horizontal Projectile', 'Introduction, Covalent Bond', 'Formal Charge', 'Ionic Bond', "Fajan'S Rules", 'Bond Parameters', 'Resonance', 'Co-Ordinate Covalent Bond', 'Valence Bond Theory', 'Hybridisation', 'Vsepr Theory', 'H-Bond, Dipole Moment', 'Mo Theory', 'Dipole Moment', 'Inter Molecular Forces', 'Gas Laws', 'Ideal Gas Equation', "Dalton'S Law", "Graham'S Law", 'Kinetic Theory & K.E', 'Molecular Velocities', "Real Gases & Vanderwaal'S Equation", 'Critical Constants', 'Liquid State', 'Characteristic Of Equillibrium', 'Kc&Kp', "Le-Chatlier'S Principle", 'Acid-Base Theories', 'Ph Concept', 'Salt Hydrolysis', 'Buffer Solutions', 'Solubility Product', "Medeleev'S Periodic Table", 'Position Of Element In P.T', 'Iupac Names', 'S,P,D,F-Block', 'Types Of Elements', 'Atomic Radius', 'Ionisation Energy', 'Electron Affinity', 'Nature Of Oxides', 'Electro Negativity, Electro Positivity, Valency', 'Introduction', 'Hydrogen', 'Water', 'Heavy Water', 'Hardness Of Water', 'H2O2', 'Hybridisation', 'Nomenclature', 'Isomerism [Structural & Stereo]', 'Reaction Intermediates', 'Attacking Regents', 'Types Of Reactions', 'Electron Displacements', 'Purification Of Organic Compounds', 'Qualitative & Quantitative Analysis', 'Alkanes', 'Alkenes', 'Alkynes', 'Benzene', 'Types Of Solutions', 'Concentration Methods', "Henry'S Law, Raoult'S Law", 'Colligative Properties', 'Abnormal Molar Mass', 'Oxidation Number', 'Oxidation & Reduction', 'Balancing Of Redox Reactions', 'Rate Of Reaction', 'Order And Molecularity', 'Half Life', 'Collision Theory', 'Characteristic Properties', 'Kmno4', 'K2Cr2O7', 'Lanthanides And Actinides', 'Iupac Nomenclature', 'Isomerism', "Werner'S Theory", 'Valence Bond Theory', 'Crystal Field Theory', 'Organo Metallic Compounds & Importance Of Coordination Compounds', 'Alkylhalides', 'Arylhalides', 'Alcohols', 'Phenols', 'Ethers', 'Carbohydrates', 'Amino Acids', 'Nucleic Acids', 'Harmones, Enzymes & Proteins', 'Vitamins', 'Drugs And Their Classification', 'Soaps And Detergents', 'Nitrogen Family [Group-15]', 'Oxygen Family [Group-16]', 'Halogens [Group-17]', 'Inert Gases [Group-18]', 'Alkali Metals', 'Alkaline Earth Metals', 'Environmental Chemistry', 'Types Of Solids', 'Crystal Systems', 'Close Packed Structures', 'Structures Of Ionic Compounds', 'Stoichiometric Defects, Non-Stoichiometric Defects', 'Electrical And Magnetic Properties', 'Electrolysis', 'Faradays Laws', 'Electrochemical Cells', 'Electrode Potential', 'Nernst Equation', 'Conductance', 'Batteries,Corrosion', 'Adsorption', 'Catalysis', 'Colloidal State', 'Emulisions, Soaps & Detergents', 'Introduction', 'Concentration Methods Of Ores', 'Extraction Of Crude Metal', 'Refining', 'Ellingham Diagram', 'Extraction Of Some Metals', 'Introduction', 'What Is Living', 'Diversity In The Living World', 'Taxonomic Categories', 'Taxonomical Aids', 'Introduction', 'Root', 'Stem', 'Leaf', 
                  'Inflorescence', 'Flower', 'Fruit', 'Seed', 'Taxonomy', 'Chromosomes And Nucleosomes', 'Prokaryotic Cell', 'Eukaryotic Cell', 'Cell Wall', 'Cell Membrane', 'Cell Organelle', 'Introduction', 'Introduction', 'Diffusion', 'Faciliated Diffusion', 'Plant Water Relations', 'Osmosis', 'Plasmolysis', 'Imbibition', 'Long Distance Transport', 'How Do Plants Absorb Water', 'Root Pressure', 'Transpiration', 'Transpiration And Photosynthesis Compromise', 'Uptake Of Minerals Ion', 'Translocation Of Mineral Ion', 'Mass Flow Hypothesis', 'Biotechnological Applications In Agriculture', 'Medicine', 'Bio Safety And Ethical Issues', 'Genetically Engineered Insulin', 'Gene Therapy', 'Transgenic Animals', 'Biotechnological Applications In Medicine', 'Ecological Succession', 'Eco System-Structure And Function', 'Productivity', 'Decomposition', 'Energy Flow', 'Ecological Pyramids', 'Nutrient Cycling', 'Introduction', 'Monera', 'Protista', 'Fungi', 'Virus, Viroids,Prions And Lichens', 'Plantae And Animalea', 'Algae', 'Chlorophycea', 'Phaeophycea', 'Rhodophycea', 'Bryophyta', 'Pteridophyta', 'Gymnosperm', 'Angiosperms', 'Bryopsida', 'Bryophytes', 'Pteridophytes', 'Gymnosperms', 'Life Cycles Of Different Plant Groups', 'Introduction Of Plant Kingdom', 'Meristems', 'Collenchyma', 'Sclerenchyma', 'Complex Tissues', 'Xylem', 'Phloem', 'Tissue System', 'Anatomy Of Mono Cot Root', 'Anatomy Of Dicot Root', 'Dicot Stem', 'Monocot Stem', 'Dicot Leaf', 'Monocot Leaf', 'Secondary Growth', 'Parenchyma', 'Introduction', 'Amino Acids', 'Lipid', 'Polysaccarides', 'Nature Of Bond Linking In Monomers', 'Nucleic Acid', 'Protein', 'Concept Of Metabolism', 'Enzymes', 'Introduction', 'Amitosis', 'Interphase', 'Mitosis', 'Meiosis', 'Introduction', 'Essential Elements', 'Deficiency Symptoms', 'N2-Metab0Lism', 'Ion Uptake', 'Root Nodule Formation', 'Photorespiration And C4-Cycle', 'Light Phase', 'Dark Phase', 'Factors Affect Photosynthesis', 'Introduction', 'Introduction', 'Do Plants Breath', 'Glycolysis', 'Fermentation', 'Aerobic Respiration', 'R.Q', 'Introduction', 'Growth', 'Development', 'Growth Regulators', 'Photoperiodism', 'Seed Dormancy', 'Vernalisation', 'Introduction', 'Pre Fertilization Structure And Events', 'Post Fertilization Structure And Events', 'Apomixis And Polyembryony', 'Double Fertilization', 'Introduction', 'Dna', 'The Search Of Genetic Material', 'Replication', 'Rna World', 'Transcription', 'Genetic Code', 'Translation', 'Mutations', 'Lac Operon', 'Human Genome Project', 'Dna Finger Printing', 'Introduction', 'Asexual Reproduction', 'Sexual Reproduction', 'Origin Of Life', 'Evolution Of Life Forms-A Theory', 'What Are The Evidences For Evolution', 'What Is Adaptive Radiation', 'Biological Evolution', 'Mechanism Of Evolution', 'Hardy-Weinberg Principle', 'A Brief Account Of Evolution', 'Origin And Evolution Of Man', 'Introduction', 'Common Diseases In Man', 'Immunity', 'Aids', 'Cancer', 'Drugs And Alcohol Abuse', 'Allergies', 'Vaccines', 'Introduction', 'Plant Breeding', 'S.C.P', 'Tissue Culture', 'Animal Husbandry', 'Introduction', 'Microbes In House Hold', 'S.T.P', 'Bio Gas', 'Bio Fertilizers', 'Basis Of Classification', 'Classification Of Animals', 'Porifera', 'Cnidaria', 'Ctenophora', 'Platyhelminthes', 'Aschelminthes', 'Annelida', 'Arthropoda', 'Mollusca', 'Echinodermata', 'Hemichordata', 'Chordata', 'Fundamental Characters Of Chordata', 'Protochordata', 'Cyclostomata', 'Pisces', 'Amphibia', 'Reptilia', 'Aves', 'Mammalia', 'Animal Tissues', 'Epithelial Tissue', 'Connective Tissue', 'Muscular Tissue', 'Neural Tissue', 'Organ And Organ System', 'Earth Worm', 'Cockroach', 'Frog', 'Respiratory Organs', 'Human Respiratory System', 'Mechanism Of Breathing', 'Respiratory Volumes And Capacities', 'Exchange Of Gases', 'Transport Of Gases', 'Regulation Of Respiration', 'Disorders Of Respiratory System', 'Blood', 'Blood Groups', 'Coagulation Of Blood', 'Lymph', 'Circulatory Pathways', 'Human Circulatory System', 'Cardiac Cycle', 'Ecg', 'Double Circulation', 'Regulation Of Cardiac Activity', 'Disorders Of Circulatory System', 'Introduction', 'Human Excretory System', 'Urine Formation', 'Function Of The Tubules', 'Mechanism Of Concentration Of The Filterate', 'Regulation Of Kidney Function', 'Micturition', 'Roles Of Other Organs In Excretion', 'Excretory System-Disorders', 'Types Of Movement', 'Muscles', 'Structure Of Contractile Proteins', 'Mechanism Of Muscle Contraction', 'Skeletal System', 'Joints', 'Disorders Of Muscular And Skeltal System', 'Neural System', 'Human Neural System', 'Neuron As Structural And Functional Unit Of Neural System', 'Generation And Conduction Of Nerve Impulse', 'Trasmission Of Impulses', 'Central Neural System', 'Reflex Action And Reflex Arc', 'Sensory Reception And Processing-The Eye', 'The Ear', 'Endocrine Glands And Hormones', 'Human Endocrine System', 'Hypothalamus', 'The Pituitary Gland', 'The Pineal Gland', 'Thyroid Gland', 'Parathyroid Gland', 'Thymus Gland', 'Adrenal Gland', 'Pancreas', 'Testis', 'Ovaries', 'Hormones Of Heart Kidney And Gastrointestinal Tract', 'Mechanism Of Hormonal Action', 'The Male Reproductive System', 'The Female Reproductive System', 'Gametogenesis', 'Menstrual Cycle', 'Fertilisation And Implantation', 'Pregnancy And Embryonic Development', 'Parturition And Lactation', 'Reproductive Health-Problems And Strategies', 'Population Explosion And Birth Control', 'Medical Termination Of Pregnancy (Mtp)', 'Sexually Transmitted Diseases (Stds)', 'Infertility', 'Types of relations (reflexive, symmetric, transitive, equivalence)', 'Types of functions (one-one, onto)', 'Composition of functions', 'Invertible functions', 'Binary operations', 'Definition and range', 'Principal value branch', 'Elementary properties', 'Concept and notation', 'Types of matrices', 'Operations (addition, multiplication)', 'Transpose and determinant', 'Inverse of a matrix (2x2, 3x3)', 'Determinant of a square matrix', 'Properties of determinants', 'Applications in finding the area of a triangle', 'Minors and cofactors', 'Adjoint and inverse of a matrix', "Solving system of linear equations using Cramer's rule", 'Continuity and differentiability', 'Derivative of composite, implicit, exponential & logarithmic functions', 'Logarithmic differentiation', 'Second-order derivatives', "Rolle's and Lagrange's Mean Value Theorems", 'Tangents and normals', 'Increasing/decreasing functions', 'Maxima and minima (first derivative test and second derivative test)', 'Rate of change of quantities', 'Indefinite integrals (integration as the inverse process of differentiation)', 'Integration of standard functions', 'Methods of integration (substitution, partial fractions, integration by parts)', 'Definite integrals and their properties', 'Fundamental Theorem of Calculus', 'Area under simple curves (lines, circles, parabolas, ellipses)', 'Area between two curves', 'Definition, order, and degree', 'Formation of differential equations', 'Solving first order, first degree differential equations (variable separable, homogeneous, linear)', 'Vectors and scalars', 'Components of a vector', 'Addition of vectors', 'Multiplication by a scalar', 'Position vector of a point dividing a line segment', 'Dot and cross product of vectors', 'Scalar triple product', 'Direction cosines and ratios', 'Cartesian and vector equation of a line and plane', 'Angle between two lines, two planes, line & plane', 'Shortest distance between lines', 'Introduction to constraints and optimization', 'Graphical method for solving linear programming problems (two variables)', 'Conditional probability', 'Multiplication rule', 'Independent events', "Bayes' theorem", 'Random variables and probability distributions (Binomial distribution)']

class RefineDataStore(Base):
    __tablename__ = 'ai_pdf_questions'
    __table_args__ = {'extend_existing': True}
    s_no = Column(Integer, primary_key=True, autoincrement=True)
    user_id = Column(Integer, nullable=False)
    uuid = Column(Integer, nullable=False)
    file_name = Column(String(255), nullable=True)
    stream = Column(String(255), nullable=True)  # Stream name
    question = Column(Text, nullable=False)
    correct_opt = Column(String(255), nullable=False)
    option_a = Column(Text, nullable=False)  # Option A
    option_b = Column(Text, nullable=False)  # Option B
    option_c = Column(Text, nullable=False)  # Option C
    option_d = Column(Text, nullable=False)  # Option D
    answer_desc = Column(Text, nullable=False)
    difficulty = Column(Integer, nullable=False)
    question_type = Column(Integer, nullable=False)
    t_id = Column(Integer, nullable=False)  # Topic ID
    s_id = Column(Integer, nullable=False)  # Subject ID
    c_id = Column(Integer, nullable=False)  # Chapter ID
    cognitive_level=Column(Integer, nullable=False)
    keywords = Column(Text, nullable=True)
    estimated_time=Column(Float, nullable=True)
    QC = Column(Text, nullable=False)
    model= Column(Text, nullable=True)
    model_id = Column(Integer, nullable=False)
    reason = Column(Text, nullable=True)
    q_image= Column(String(255), nullable=True)
    option_1_image= Column(String(255), nullable=True)
    option_2_image= Column(String(255), nullable=True)
    option_3_image= Column(String(255), nullable=True)
    option_4_image= Column(String(255), nullable=True)

difficulty_level={"easy":1,
                  "medium":2,
                  "hard":3,
                  "veryhard":4}

cognitive_levels = {
    "remembering": 1,    
    "understanding": 2,
    "applying": 3,
    "application":3,
    "analyzing": 4,
    "evaluating": 5,
    "creating": 6       
}     
  
question_types = {
    "direct_concept_based": 1,
    "conceptual_problem": 1,
    "direct": 1,
    "assertion_reason": 2,
    "numerical_problem": 3,
    "diagram_Based_Question": 4,
    "multiple_correct_answer": 5,
    "matching_type": 6,
    "comprehension_type": 7,
    "case_study_based": 8,
    "statement_based": 9,
    "True_false type": 10,
    "single_correct_answer":11
}

model_dict={1:"gemini-3-flash-preview",
2:"gemini-3-flash-preview",
3:"gemini-3-flash-preview",
4:"gemini-3-pro-preview",
5:"o4-mini"}

stream_dict={"neet":1, 
             "cbse":2, 
             "jee":3}
